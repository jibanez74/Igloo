{"version":3,"file":"rewrite.js","sources":["../../src/rewrite.ts"],"sourcesContent":["import { joinPaths, trimPath } from './path'\nimport type { LocationRewrite } from './router'\n\n/** Compose multiple rewrite pairs into a single in/out rewrite. */\n/** Compose multiple rewrite pairs into a single in/out rewrite. */\nexport function composeRewrites(rewrites: Array<LocationRewrite>) {\n  return {\n    input: ({ url }) => {\n      for (const rewrite of rewrites) {\n        url = executeRewriteInput(rewrite, url)\n      }\n      return url\n    },\n    output: ({ url }) => {\n      for (let i = rewrites.length - 1; i >= 0; i--) {\n        url = executeRewriteOutput(rewrites[i], url)\n      }\n      return url\n    },\n  } satisfies LocationRewrite\n}\n\n/** Create a rewrite pair that strips/adds a basepath on input/output. */\n/** Create a rewrite pair that strips/adds a basepath on input/output. */\nexport function rewriteBasepath(opts: {\n  basepath: string\n  caseSensitive?: boolean\n}) {\n  const trimmedBasepath = trimPath(opts.basepath)\n  const normalizedBasepath = `/${trimmedBasepath}`\n  const normalizedBasepathWithSlash = `${normalizedBasepath}/`\n  const checkBasepath = opts.caseSensitive\n    ? normalizedBasepath\n    : normalizedBasepath.toLowerCase()\n  const checkBasepathWithSlash = opts.caseSensitive\n    ? normalizedBasepathWithSlash\n    : normalizedBasepathWithSlash.toLowerCase()\n\n  return {\n    input: ({ url }) => {\n      const pathname = opts.caseSensitive\n        ? url.pathname\n        : url.pathname.toLowerCase()\n\n      // Handle exact basepath match (e.g., /my-app -> /)\n      if (pathname === checkBasepath) {\n        url.pathname = '/'\n      } else if (pathname.startsWith(checkBasepathWithSlash)) {\n        // Handle basepath with trailing content (e.g., /my-app/users -> /users)\n        url.pathname = url.pathname.slice(normalizedBasepath.length)\n      }\n      return url\n    },\n    output: ({ url }) => {\n      url.pathname = joinPaths(['/', trimmedBasepath, url.pathname])\n      return url\n    },\n  } satisfies LocationRewrite\n}\n\n/** Execute a location input rewrite if provided. */\n/** Execute a location input rewrite if provided. */\nexport function executeRewriteInput(\n  rewrite: LocationRewrite | undefined,\n  url: URL,\n): URL {\n  const res = rewrite?.input?.({ url })\n  if (res) {\n    if (typeof res === 'string') {\n      return new URL(res)\n    } else if (res instanceof URL) {\n      return res\n    }\n  }\n  return url\n}\n\n/** Execute a location output rewrite if provided. */\n/** Execute a location output rewrite if provided. */\nexport function executeRewriteOutput(\n  rewrite: LocationRewrite | undefined,\n  url: URL,\n): URL {\n  const res = rewrite?.output?.({ url })\n  if (res) {\n    if (typeof res === 'string') {\n      return new URL(res)\n    } else if (res instanceof URL) {\n      return res\n    }\n  }\n  return url\n}\n"],"names":[],"mappings":";AAKO,SAAS,gBAAgB,UAAkC;AAChE,SAAO;AAAA,IACL,OAAO,CAAC,EAAE,UAAU;AAClB,iBAAW,WAAW,UAAU;AAC9B,cAAM,oBAAoB,SAAS,GAAG;AAAA,MACxC;AACA,aAAO;AAAA,IACT;AAAA,IACA,QAAQ,CAAC,EAAE,UAAU;AACnB,eAAS,IAAI,SAAS,SAAS,GAAG,KAAK,GAAG,KAAK;AAC7C,cAAM,qBAAqB,SAAS,CAAC,GAAG,GAAG;AAAA,MAC7C;AACA,aAAO;AAAA,IACT;AAAA,EAAA;AAEJ;AAIO,SAAS,gBAAgB,MAG7B;AACD,QAAM,kBAAkB,SAAS,KAAK,QAAQ;AAC9C,QAAM,qBAAqB,IAAI,eAAe;AAC9C,QAAM,8BAA8B,GAAG,kBAAkB;AACzD,QAAM,gBAAgB,KAAK,gBACvB,qBACA,mBAAmB,YAAA;AACvB,QAAM,yBAAyB,KAAK,gBAChC,8BACA,4BAA4B,YAAA;AAEhC,SAAO;AAAA,IACL,OAAO,CAAC,EAAE,UAAU;AAClB,YAAM,WAAW,KAAK,gBAClB,IAAI,WACJ,IAAI,SAAS,YAAA;AAGjB,UAAI,aAAa,eAAe;AAC9B,YAAI,WAAW;AAAA,MACjB,WAAW,SAAS,WAAW,sBAAsB,GAAG;AAEtD,YAAI,WAAW,IAAI,SAAS,MAAM,mBAAmB,MAAM;AAAA,MAC7D;AACA,aAAO;AAAA,IACT;AAAA,IACA,QAAQ,CAAC,EAAE,UAAU;AACnB,UAAI,WAAW,UAAU,CAAC,KAAK,iBAAiB,IAAI,QAAQ,CAAC;AAC7D,aAAO;AAAA,IACT;AAAA,EAAA;AAEJ;AAIO,SAAS,oBACd,SACA,KACK;AACL,QAAM,MAAM,SAAS,QAAQ,EAAE,KAAK;AACpC,MAAI,KAAK;AACP,QAAI,OAAO,QAAQ,UAAU;AAC3B,aAAO,IAAI,IAAI,GAAG;AAAA,IACpB,WAAW,eAAe,KAAK;AAC7B,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;AAIO,SAAS,qBACd,SACA,KACK;AACL,QAAM,MAAM,SAAS,SAAS,EAAE,KAAK;AACrC,MAAI,KAAK;AACP,QAAI,OAAO,QAAQ,UAAU;AAC3B,aAAO,IAAI,IAAI,GAAG;AAAA,IACpB,WAAW,eAAe,KAAK;AAC7B,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;"}