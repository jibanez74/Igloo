import"./useQuery-DYliyyeq.js";import{a as e,i as t,n,o as r,r as i,t as a}from"./dialog-BHOyGAmv.js";import{t as o}from"./arrow-left-CHge2wga.js";import{t as ee}from"./calendar-C5yRxf-G.js";import{a as s,i as c,n as l,r as u,t as te}from"./TrackItem-D52HMG6c.js";import{t as d}from"./circle-alert-BBYeejEm.js";import{t as f}from"./clock-BRDoWx7G.js";import{t as p}from"./ellipsis-DakNDuIj.js";import{t as m}from"./list-ordered-CLejkNMT.js";import{t as h}from"./music-DCJfo9yH.js";import"./plus-DrfurNsD.js";import{t as g}from"./shuffle-SybXheIC.js";import{t as _}from"./trash-2-CWBGQmm5.js";import{t as v}from"./user-wQOA0tR5.js";import{Dt as y,J as b,Mt as x,Tt as S,Y as C,en as w,gt as T,ht as E,jt as D,kt as O,n as k,t as ne,tt as re,vt as A}from"./index-B4Mm07st.js";import"./dist-D9YK6Fjb.js";import"./dist-DoMa5iEY.js";import"./dist-DehwVPxN.js";import"./dist-m3SJwciI.js";import"./dist-BE3VF_ow.js";import{i as j,t as M}from"./toast-helpers-N18T5b5Z.js";import"./button-DUpsrK_w.js";import"./dist-DRYwAtpY.js";import"./input-COadufZY.js";import{n as N,r as P}from"./nullable-DZsmEyNt.js";import{n as F,r as I,t as L}from"./alert-DRXpCir_.js";var R=O(),z=w(),B=x();function V(){let e=(0,R.c)(7),t=k.useLoaderData();if(t.error){let n,r;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(n=(0,B.jsx)(d,{className:`size-4`,"aria-hidden":`true`}),r=(0,B.jsx)(I,{children:`Error`}),e[0]=n,e[1]=r):(n=e[0],r=e[1]);let i=t.message||`Failed to load album details. Please try again later.`,a;return e[2]===i?a=e[3]:(a=(0,B.jsxs)(L,{variant:`destructive`,className:`border-red-500/20 bg-red-500/10 text-red-400`,children:[n,r,(0,B.jsx)(F,{children:i})]}),e[2]=i,e[3]=a),a}if(!t.data?.album){let t;return e[4]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,B.jsx)(`div`,{className:`py-12 text-center`,children:(0,B.jsx)(`h2`,{className:`text-xl font-semibold text-slate-300`,children:`Album not found`})}),e[4]=t):t=e[4],t}let n;return e[5]===t.data?n=e[6]:(n=(0,B.jsx)(H,{...t.data}),e[5]=t.data,e[6]=n),n}function H({album:d,tracks:v,artists:x,track_genres:w,album_genres:O,total_duration:k}){let F=ne(),I=C(),L=D(),[R,V]=(0,z.useState)(!1),[H,W]=(0,z.useState)(!1),G=P(d.cover),K=N(d.year),q=P(d.musician),J=q?`${d.title} by ${q} - Igloo`:`${d.title} - Igloo`,Y=`Listen to ${d.title}${q?` by ${q}`:``} - ${v.length} tracks in your Igloo music library.`,X=async()=>{W(!0);try{let e=await re(d.id);if(e.error){M(`delete album`,e.message||`Unable to delete album. Please try again.`);return}j(`Album`,`"${d.title}" has been removed from your library.`),L.invalidateQueries({queryKey:[`albums`]}),L.invalidateQueries({queryKey:[`music-stats`]}),I({to:`/music`,search:{tab:`albums`}})}catch(e){console.error(`Failed to delete album:`,e),M(`delete album`,`An unexpected error occurred. Please try again.`)}finally{W(!1),V(!1)}},Z=new Map;w.forEach(e=>{let t=Z.get(e.track_id)||[];t.push(e.tag),Z.set(e.track_id,t)});let Q=v.reduce((e,t)=>{let n=t.disc||1;return e[n]||(e[n]=[]),e[n].push(t),e},{}),$=Object.keys(Q).map(Number).sort((e,t)=>e-t),ie=$.length>1,ae=e=>F.currentTrack?.id===e.id&&F.isPlaying,oe=e=>{F.currentTrack?.id===e.id?F.togglePlay():F.playTrack(e,v,{cover:G,title:d.title,musician:q})},se=()=>{F.playAlbum(v,{cover:G,title:d.title,musician:q})},ce=()=>{F.shuffleAlbum(v,{cover:G,title:d.title,musician:q})};return(0,B.jsxs)(`article`,{"aria-labelledby":`album-title`,children:[(0,B.jsx)(`title`,{children:J}),(0,B.jsx)(`meta`,{name:`description`,content:Y}),(0,B.jsxs)(`header`,{className:`mb-10 flex flex-col gap-8 md:flex-row`,children:[(0,B.jsx)(`figure`,{className:`mx-auto shrink-0 md:mx-0`,children:(0,B.jsx)(`div`,{className:`w-64 overflow-hidden rounded-xl border border-amber-500/20 shadow-2xl shadow-amber-500/10 md:w-72 lg:w-80`,children:G?(0,B.jsx)(`img`,{src:G,alt:`Album cover for ${d.title}`,className:`aspect-square w-full object-cover`}):(0,B.jsx)(`div`,{className:`flex aspect-square w-full items-center justify-center bg-slate-800`,role:`img`,"aria-label":`No cover available`,children:(0,B.jsx)(y,{className:`size-16 text-slate-600`,"aria-hidden":`true`})})})}),(0,B.jsxs)(`div`,{className:`flex flex-1 flex-col`,children:[(0,B.jsx)(`h1`,{id:`album-title`,className:`text-3xl font-bold text-white md:text-4xl lg:text-5xl`,children:d.title}),q&&(0,B.jsx)(`p`,{className:`mt-2 text-xl font-medium text-amber-400`,children:q}),(0,B.jsxs)(`ul`,{className:`mt-4 flex flex-wrap items-center gap-4 text-slate-400`,"aria-label":`Album details`,children:[(d.release_date.Valid||K)&&(0,B.jsxs)(`li`,{className:`flex items-center gap-1.5`,children:[(0,B.jsx)(ee,{className:`size-4 text-slate-400`,"aria-hidden":`true`}),(0,B.jsx)(`time`,{dateTime:d.release_date.String||String(K),children:d.release_date.Valid?E(d.release_date.String):K})]}),(0,B.jsxs)(`li`,{className:`flex items-center gap-1.5`,children:[(0,B.jsx)(h,{className:`size-4 text-slate-400`,"aria-hidden":`true`}),(0,B.jsxs)(`span`,{children:[v.length,` `,v.length===1?`track`:`tracks`]})]}),(0,B.jsxs)(`li`,{className:`flex items-center gap-1.5`,children:[(0,B.jsx)(f,{className:`size-4 text-slate-400`,"aria-hidden":`true`}),(0,B.jsx)(`span`,{children:T(k)})]}),d.spotify_popularity.Valid&&(0,B.jsxs)(`li`,{className:`flex items-center gap-1.5`,"aria-label":`Spotify Popularity`,children:[(0,B.jsx)(`svg`,{className:`size-4 text-green-500`,viewBox:`0 0 24 24`,fill:`currentColor`,"aria-hidden":`true`,children:(0,B.jsx)(`path`,{d:`M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z`})}),(0,B.jsxs)(`span`,{children:[(0,B.jsx)(`span`,{className:`text-slate-400`,children:`Popularity:`}),` `,(0,B.jsx)(`span`,{className:`font-medium text-green-400`,children:Math.round(d.spotify_popularity.Float64)})]})]})]}),O.length>0&&(0,B.jsx)(`ul`,{className:`mt-4 flex flex-wrap gap-2`,"aria-label":`Genres: ${O.join(`, `)}`,children:O.map(e=>(0,B.jsx)(`li`,{className:`rounded-full border border-amber-500/30 bg-slate-800/80 px-3 py-1 text-sm text-amber-200 backdrop-blur-sm`,children:e},e))}),(0,B.jsxs)(`div`,{className:`mt-6 flex flex-wrap gap-3`,children:[(0,B.jsxs)(`button`,{onClick:se,className:`inline-flex items-center gap-2 rounded-full bg-amber-500 px-6 py-3 font-semibold text-slate-900 shadow-lg shadow-amber-500/20 transition-colors hover:bg-amber-400`,children:[(0,B.jsx)(S,{className:`size-4 fill-current`,"aria-hidden":`true`}),`Play Album`]}),(0,B.jsxs)(`button`,{onClick:ce,className:`inline-flex items-center gap-2 rounded-full border border-slate-600 bg-slate-700 px-6 py-3 font-semibold text-white transition-colors hover:bg-slate-600`,"aria-label":`Shuffle play album`,children:[(0,B.jsx)(g,{className:`size-4`,"aria-hidden":`true`}),`Shuffle`]}),(0,B.jsxs)(l,{children:[(0,B.jsx)(s,{asChild:!0,children:(0,B.jsx)(`button`,{className:`inline-flex items-center gap-2 rounded-full border border-slate-600 bg-slate-700 px-4 py-3 font-semibold text-white transition-colors hover:bg-slate-600`,"aria-label":`More options`,children:(0,B.jsx)(p,{className:`size-4`,"aria-hidden":`true`})})}),(0,B.jsx)(u,{align:`end`,className:`border-slate-700 bg-slate-800`,children:(0,B.jsxs)(c,{onClick:()=>V(!0),className:`cursor-pointer text-red-400 focus:bg-red-500/10 focus:text-red-400`,children:[(0,B.jsx)(_,{className:`mr-2 size-4`,"aria-hidden":`true`}),`Delete Album`]})})]})]}),(0,B.jsx)(a,{open:R,onOpenChange:V,children:(0,B.jsxs)(n,{className:`border-slate-700 bg-slate-900 text-white`,children:[(0,B.jsxs)(e,{children:[(0,B.jsx)(r,{className:`text-white`,children:`Delete Album`}),(0,B.jsxs)(i,{className:`text-slate-400`,children:[`Are you sure you want to delete "`,d.title,`"? This action cannot be undone and will permanently remove:`]})]}),(0,B.jsxs)(`ul`,{className:`ml-4 list-disc space-y-1 text-sm text-slate-300`,children:[(0,B.jsx)(`li`,{children:`The album and all its metadata`}),(0,B.jsxs)(`li`,{children:[`All `,v.length,` `,v.length===1?`track`:`tracks`,` `,`associated with this album`]}),(0,B.jsx)(`li`,{children:`All genre and artist associations`})]}),(0,B.jsxs)(t,{className:`gap-2 sm:gap-0`,children:[(0,B.jsx)(`button`,{onClick:()=>V(!1),disabled:H,className:`rounded-lg border border-slate-600 bg-slate-700 px-4 py-2 font-medium text-white transition-colors hover:bg-slate-600 disabled:opacity-50`,children:`Cancel`}),(0,B.jsx)(`button`,{onClick:X,disabled:H,className:`rounded-lg bg-red-600 px-4 py-2 font-medium text-white transition-colors hover:bg-red-500 disabled:opacity-50`,children:H?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(A,{className:`mr-2 size-4`}),`Deleting...`]}):`Delete Album`})]})]})}),x.length>0&&(0,B.jsxs)(`section`,{className:`mt-6`,"aria-labelledby":`artists-heading`,children:[(0,B.jsx)(`h2`,{id:`artists-heading`,className:`mb-3 text-sm font-semibold tracking-wide text-slate-400 uppercase`,children:x.length===1?`Artist`:`Artists`}),(0,B.jsx)(`div`,{className:`flex flex-wrap gap-3`,children:x.map(e=>(0,B.jsx)(U,{artist:e},e.id))})]})]})]}),(0,B.jsxs)(`section`,{"aria-labelledby":`tracklist-heading`,children:[(0,B.jsxs)(`h2`,{id:`tracklist-heading`,className:`mb-4 flex items-center gap-2 text-xl font-semibold text-white`,children:[(0,B.jsx)(m,{className:`size-5 text-amber-400`,"aria-hidden":`true`}),`Track List`]}),(0,B.jsx)(`div`,{className:`overflow-hidden rounded-xl border border-amber-500/10 bg-slate-800/30`,children:$.map(e=>(0,B.jsxs)(`div`,{children:[ie&&(0,B.jsx)(`div`,{className:`border-b border-slate-700/50 bg-slate-800/50 px-4 py-2`,children:(0,B.jsxs)(`span`,{className:`flex items-center gap-2 text-sm font-medium text-slate-400`,children:[(0,B.jsx)(y,{className:`size-4 text-amber-400/70`,"aria-hidden":`true`}),`Disc `,e]})}),(0,B.jsx)(`div`,{className:`divide-y divide-slate-700/30`,children:Q[e].map(e=>(0,B.jsx)(te,{id:e.id,title:e.title,duration:e.duration,trackIndex:e.track_index,genres:Z.get(e.id)||[],variant:`album`,isPlaying:ae(e),isCurrentTrack:F.currentTrack?.id===e.id,onPlay:()=>oe(e)},e.id))})]},e))})]}),(0,B.jsxs)(`section`,{className:`mt-10 rounded-xl border border-amber-500/10 bg-slate-800/30 p-4`,"aria-labelledby":`details-heading`,children:[(0,B.jsx)(`h2`,{id:`details-heading`,className:`mb-4 text-lg font-semibold text-white`,children:`Album Details`}),(0,B.jsxs)(`dl`,{className:`grid grid-cols-2 gap-6 text-sm sm:grid-cols-3 lg:grid-cols-4`,children:[d.release_date.Valid&&(0,B.jsxs)(`div`,{children:[(0,B.jsx)(`dt`,{className:`font-semibold tracking-wide text-amber-300/70 uppercase`,children:`Release Date`}),(0,B.jsx)(`dd`,{className:`mt-1 text-white`,children:E(d.release_date.String)})]}),(0,B.jsxs)(`div`,{children:[(0,B.jsx)(`dt`,{className:`font-semibold tracking-wide text-amber-300/70 uppercase`,children:`Total Tracks`}),(0,B.jsx)(`dd`,{className:`mt-1 text-white`,children:v.length})]}),(0,B.jsxs)(`div`,{children:[(0,B.jsx)(`dt`,{className:`font-semibold tracking-wide text-amber-300/70 uppercase`,children:`Total Duration`}),(0,B.jsx)(`dd`,{className:`mt-1 text-white`,children:T(k)})]})]})]}),(0,B.jsx)(`div`,{className:`mt-8`,children:(0,B.jsxs)(b,{to:`/`,className:`inline-flex items-center gap-2 text-slate-400 transition-colors hover:text-amber-400`,children:[(0,B.jsx)(o,{className:`size-4`,"aria-hidden":`true`}),`Back to Home`]})})]})}function U(e){let t=(0,R.c)(8),{artist:n}=e,r;t[0]!==n.thumb.String||t[1]!==n.thumb.Valid?(r=n.thumb.Valid?(0,B.jsx)(`img`,{src:n.thumb.String,alt:``,className:`h-6 w-6 rounded-full object-cover`}):(0,B.jsx)(`div`,{className:`flex h-6 w-6 items-center justify-center rounded-full bg-slate-700`,children:(0,B.jsx)(v,{className:`size-3 text-slate-400`,"aria-hidden":`true`})}),t[0]=n.thumb.String,t[1]=n.thumb.Valid,t[2]=r):r=t[2];let i;t[3]===n.name?i=t[4]:(i=(0,B.jsx)(`span`,{className:`text-sm font-medium text-white`,children:n.name}),t[3]=n.name,t[4]=i);let a;return t[5]!==r||t[6]!==i?(a=(0,B.jsxs)(`div`,{className:`flex items-center gap-2 rounded-full border border-slate-700/50 bg-slate-800/60 px-3 py-1.5 transition-colors hover:border-amber-500/30`,children:[r,i]}),t[5]=r,t[6]=i,t[7]=a):a=t[7],a}export{V as component};